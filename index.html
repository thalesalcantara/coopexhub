<!doctype html>
<html lang="pt-br" data-bs-theme="light">
<head>
  <meta charset="utf-8">
  <title>Kratos System · Hub</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <meta name="theme-color" content="#2747d9">

  <!-- Fontes & Bootstrap Icons -->
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@600&family=Roboto:wght@400;700&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

  <style>
    :root{
      --royal:#2747d9;
      --royal2:#3b61e3;
      --bg1:#f2f6ff;
      --bg2:#d2e1ff;
      --glass: rgba(255,255,255,0.34);
      --glassBorder: rgba(70,90,255,0.16);
      --shadow: 0 10px 46px rgba(39,71,217,0.18);
      --green:#23bb75;
      --ink:#0b1220;
      --muted:#5b6478;
      --danger:#e74c3c;
      --tabH: 78px;
      --radius: 26px;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      min-height:100vh;
      font-family: 'Roboto', system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      background: radial-gradient(900px 500px at 20% 10%, #ffffff 0%, rgba(255,255,255,0) 60%),
                  linear-gradient(120deg, var(--bg1) 0%, var(--bg2) 100%);
      color: var(--ink);
      overflow:hidden;
    }

    /* ===== App shell ===== */
    .app{
      height:100vh;
      width:100vw;
      display:flex;
      flex-direction:column;
      position:relative;
    }

    /* Top brand bar */
    .topbar{
      padding: 14px 14px 10px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
    }

    .brand{
      display:flex;
      align-items:center;
      gap:10px;
      min-width: 0;
    }
    .brand img{
      width:42px;height:42px;border-radius:14px;
      background:#fff;
      border:1px solid rgba(255,255,255,0.85);
      box-shadow: 0 10px 24px rgba(39,71,217,.20);
      object-fit:contain;
    }
    .brand .txt{min-width:0}
    .brand .title{
      font-family:'Orbitron',sans-serif;
      letter-spacing:1.6px;
      font-size:0.98rem;
      margin:0;
      text-transform:uppercase;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .brand .sub{
      margin:2px 0 0;
      color: var(--muted);
      font-size:0.84rem;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    .pill{
      display:flex;
      align-items:center;
      gap:8px;
      padding: 10px 12px;
      border-radius: 16px;
      background: rgba(255,255,255,0.55);
      border: 1.4px solid rgba(70,90,255,0.18);
      box-shadow: 0 10px 36px rgba(39,71,217,.10);
      user-select:none;
      white-space:nowrap;
      font-size:0.86rem;
      color:#233;
    }
    .pill i{color:var(--royal2)}

    /* Main glass container */
    .stage{
      margin: 0 12px 12px;
      flex:1;
      border-radius: var(--radius);
      background: var(--glass);
      border: 1.8px solid var(--glassBorder);
      box-shadow: var(--shadow);
      overflow:hidden;
      position:relative;
      padding-bottom: var(--tabH);
    }

    /* Iframe area */
    .view{
      position:absolute;
      top:0; left:0; right:0;
      bottom: var(--tabH);
      background: rgba(255,255,255,0.26);
    }
    iframe{
      width:100%;
      height:100%;
      border:0;
      display:block;
      background:#fff;
    }

    /* Splash overlay */
    .splash{
      position:absolute; inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
      flex-direction:column;
      gap:12px;
      background: linear-gradient(135deg, rgba(39,71,217,0.92), rgba(59,97,227,0.88));
      color:#fff;
      z-index: 6;
      transition: opacity .35s ease, transform .35s ease;
    }
    .splash.hide{opacity:0; transform: scale(1.02); pointer-events:none;}
    .splash .logo{
      width:88px;height:88px;border-radius:26px;
      background:#fff;
      border: 4px solid rgba(255,255,255,0.92);
      object-fit:contain;
      box-shadow: 0 18px 46px rgba(0,0,0,0.18);
    }
    .splash .t1{
      font-family:'Orbitron',sans-serif;
      letter-spacing:2px;
      margin:0;
      text-transform:uppercase;
      font-size:1.02rem;
    }
    .splash .t2{
      margin:0;
      opacity:.92;
      font-size:.92rem;
    }

    /* Bottom tabs */
    .tabs{
      position:absolute;
      left:10px; right:10px;
      bottom:10px;
      height: calc(var(--tabH) - 20px);
      border-radius: 22px;
      background: rgba(255,255,255,0.58);
      border: 1.6px solid rgba(70,90,255,0.16);
      box-shadow: 0 14px 44px rgba(39,71,217,0.18);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      padding: 10px;
      z-index: 5;
      backdrop-filter: blur(18px) saturate(140%);
      -webkit-backdrop-filter: blur(18px) saturate(140%);
    }

    .tab{
      flex:1;
      height:100%;
      border-radius: 18px;
      display:flex;
      align-items:center;
      justify-content:center;
      gap:10px;
      padding: 10px 12px;
      text-decoration:none;
      border: 0;
      cursor:pointer;
      background: transparent;
      color: #243;
      transition: transform .12s ease, box-shadow .12s ease, background .12s ease;
      user-select:none;
    }
    .tab .ico{
      width:38px; height:38px;
      border-radius: 14px;
      display:flex; align-items:center; justify-content:center;
      background: rgba(39,71,217,0.10);
      color: var(--royal);
      font-size: 1.15rem;
      flex-shrink:0;
      transition: background .12s ease, color .12s ease;
    }
    .tab .lab{
      display:flex;
      flex-direction:column;
      align-items:flex-start;
      line-height:1.05;
      min-width:0;
    }
    .tab .lab b{
      font-size:0.86rem;
      letter-spacing:.06em;
      text-transform:uppercase;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      max-width: 100%;
    }
    .tab .lab span{
      font-size:0.74rem;
      color: var(--muted);
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      max-width: 100%;
    }

    .tab.active{
      background: linear-gradient(135deg, rgba(39,71,217,0.92), rgba(59,97,227,0.90));
      color:#fff;
      box-shadow: 0 12px 30px rgba(39,71,217,0.34);
      transform: translateY(-1px);
    }
    .tab.active .ico{
      background: rgba(255,255,255,0.18);
      color:#fff;
    }
    .tab.active .lab span{ color: rgba(255,255,255,0.86); }

    /* Fallback modal */
    .modalx{
      position:absolute;
      inset:0;
      background: rgba(10,14,30,0.48);
      display:none;
      align-items:center;
      justify-content:center;
      padding:16px;
      z-index: 7;
    }
    .modalx.show{display:flex;}
    .modalcard{
      width:min(420px, 98vw);
      border-radius: 22px;
      background: rgba(255,255,255,0.88);
      border: 1.6px solid rgba(70,90,255,0.18);
      box-shadow: 0 18px 60px rgba(0,0,0,0.22);
      padding: 16px 14px;
    }
    .modalcard h3{
      margin: 0 0 6px;
      font-family:'Orbitron',sans-serif;
      letter-spacing:1.1px;
      font-size:0.98rem;
      text-transform:uppercase;
      color:#122;
    }
    .modalcard p{
      margin: 0 0 12px;
      color:#234;
      opacity:.92;
      font-size:0.92rem;
      line-height:1.35;
    }
    .actions{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
    }
    .btnx{
      flex:1;
      min-width: 120px;
      border:0;
      border-radius: 14px;
      padding: 12px 12px;
      font-weight:700;
      cursor:pointer;
      text-transform:uppercase;
      letter-spacing:.08em;
      font-size:0.78rem;
    }
    .btn-primary{
      background: linear-gradient(135deg, var(--royal), var(--royal2));
      color:#fff;
      box-shadow: 0 12px 28px rgba(39,71,217,0.26);
    }
    .btn-ghost{
      background: rgba(39,71,217,0.10);
      color: var(--royal);
      border: 1px solid rgba(39,71,217,0.18);
    }
    .btn-close{
      width:100%;
      margin-top:10px;
      background: rgba(0,0,0,0.06);
      color:#223;
    }

    /* Small screens fine tuning */
    @media (max-width: 420px){
      .pill{display:none;}
      .tab .lab span{display:none;}
    }
  </style>
</head>

<body>
  <div class="app">

    <div class="topbar">
      <div class="brand">
        <img src="kratos-logo.png" alt="Logo Kratos System">
        <div class="txt">
          <p class="title">Kratos System</p>
          <p class="sub" id="subTitle">Hub de Acesso</p>
        </div>
      </div>

      <div class="pill">
        <i class="bi bi-shield-lock-fill"></i>
        Sessão segura
        <span style="width:6px;height:6px;border-radius:99px;background:var(--green);display:inline-block"></span>
      </div>
    </div>

    <div class="stage">

      <!-- Splash -->
      <div class="splash" id="splash">
        <img src="kratos-logo.png" class="logo" alt="Logo">
        <p class="t1">CoopexHub</p>
        <p class="t2">Carregando ambiente…</p>
      </div>

      <!-- Main view -->
      <div class="view">
        <iframe id="frame" title="CoopexHub"></iframe>
      </div>

      <!-- Bottom tabs -->
      <div class="tabs" role="tablist" aria-label="Ambientes">
        <button class="tab active" id="tab-supervisao" type="button" data-key="supervisao">
          <span class="ico"><i class="bi bi-headset"></i></span>
          <span class="lab"><b>Supervisão</b><span>Escalas e operação</span></span>
        </button>

        <button class="tab" id="tab-estab" type="button" data-key="estab">
          <span class="ico"><i class="bi bi-shop-window"></i></span>
          <span class="lab"><b>Estabelec.</b><span>Financeiro e dados</span></span>
        </button>

        <button class="tab" id="tab-parceria" type="button" data-key="parceria">
          <span class="ico"><i class="bi bi-people-fill"></i></span>
          <span class="lab"><b>Parceria</b><span>Portal de acesso</span></span>
        </button>
      </div>

      <!-- Fallback modal -->
      <div class="modalx" id="modal">
        <div class="modalcard">
          <h3 id="mTitle">Atenção</h3>
          <p id="mText">
            Este painel não permite abrir dentro do Hub (bloqueio de segurança do site).
          </p>
          <div class="actions">
            <button class="btnx btn-primary" id="btnSame">Abrir no app</button>
            <button class="btnx btn-ghost" id="btnNew">Abrir em nova aba</button>
          </div>
          <button class="btnx btn-close" id="btnClose">Voltar</button>
        </div>
      </div>

    </div>
  </div>

<script>
(function(){
  // === LINKS DOS SEUS PAINÉIS ===
  const APPS = {
    supervisao: {
      name: "Supervisão",
      url: "https://escalas-2-1.onrender.com/",
      hint: "Escalas, turnos e controle operacional."
    },
    estab: {
      name: "Estabelecimentos",
      url: "https://financas-dxsu.onrender.com/",
      hint: "Financeiro, lançamentos e relatórios."
    },
    parceria: {
      name: "Parceria",
      url: "https://kratossystem.onrender.com/login",
      hint: "Portal de integração com o Kratos System."
    }
  };

  const frame = document.getElementById("frame");
  const splash = document.getElementById("splash");
  const subTitle = document.getElementById("subTitle");

  const modal = document.getElementById("modal");
  const mTitle = document.getElementById("mTitle");
  const mText  = document.getElementById("mText");
  const btnSame = document.getElementById("btnSame");
  const btnNew  = document.getElementById("btnNew");
  const btnClose= document.getElementById("btnClose");

  const tabs = Array.from(document.querySelectorAll(".tab"));

  let currentKey = "supervisao";
  let currentUrl = APPS[currentKey].url;

  // Splash behavior
  function showSplash(msg){
    splash.classList.remove("hide");
    splash.querySelector(".t2").textContent = msg || "Carregando ambiente…";
  }
  function hideSplash(){
    splash.classList.add("hide");
  }

  // Modal behavior
  function openModal(title, text, url){
    mTitle.textContent = title;
    mText.textContent  = text;
    modal.classList.add("show");

    btnSame.onclick = () => { window.location.href = url; };
    btnNew.onclick  = () => { window.open(url, "_blank"); };
  }
  function closeModal(){
    modal.classList.remove("show");
  }
  btnClose.addEventListener("click", closeModal);
  modal.addEventListener("click", (e)=>{ if(e.target === modal) closeModal(); });

  // Try to load iframe, fallback if blocked
  function loadApp(key){
    currentKey = key;
    const app = APPS[key];
    currentUrl = app.url;

    // UI
    tabs.forEach(t => t.classList.toggle("active", t.dataset.key === key));
    subTitle.textContent = app.name + " · " + (app.hint || "");

    // Persist choice
    localStorage.setItem("coopexhub_last", key);

    // Load
    showSplash("Abrindo " + app.name + "…");
    frame.src = app.url;

    // If iframe loads, hide splash
    const onLoad = () => {
      hideSplash();
      frame.removeEventListener("load", onLoad);
    };
    frame.addEventListener("load", onLoad);

    // Fallback timer: if blocked, many browsers never "load" properly.
    // We'll wait a few seconds and show fallback option.
    setTimeout(() => {
      // If splash still visible, we assume blocked or slow.
      if (!splash.classList.contains("hide")) {
        openModal(
          app.name,
          "Este painel pode estar bloqueando abertura dentro do Hub (segurança do site). Você pode abrir normalmente no app agora.",
          app.url
        );
      }
    }, 4500);
  }

  // Tab clicks
  tabs.forEach(t => t.addEventListener("click", ()=> loadApp(t.dataset.key)));

  // Initial load: last used or default
  const last = localStorage.getItem("coopexhub_last");
  if (last && APPS[last]) currentKey = last;

  // Start
  loadApp(currentKey);

})();
</script>
</body>
</html>
